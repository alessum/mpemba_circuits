name: Run & Commit runnerU1_pure.py

on:
  workflow_dispatch:
    inputs:
      circuit_to_run:
        description: 'Circuit index (integer)'
        required: true
        type: number

permissions:
  contents: write   # grant write access to GITHUB_TOKEN

jobs:
  simulate-and-commit:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code (sparse)
        uses: actions/checkout@v4
        with:
          # Fetch full history if you need it (optional)
          fetch-depth: 0
          # Disable cone mode to allow exclusion patterns
          sparse-checkout-cone-mode: false
          # Include just the 'data' folder, but exclude U1_theta* files
          sparse-checkout: |
            data
            !data/U1_theta*

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Run runnerU1_pure.py for next 10 circuits
        run: |
          start=${{ github.event.inputs.circuit_to_run }}
          end=$(( start + 10 ))
          echo "Running circuits from $start to $end"
          for i in $(seq $start $end); do
            echo "â†’ circuit $i"
            python runnerU1_pure.py --circuit_to_run $i
          done

      - name: Auto-commit changed files
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'Auto-commit from GitHub Actions'
